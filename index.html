<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goku AI - User Panel</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    
    <!-- Link to Logic File -->
    <script type="module" src="logic.js" defer></script>

    <style>
        /* --- GOKU THEME --- */
        body { background-color: #050505; color: #e6edf3; font-family: 'Segoe UI', monospace; text-align: center; margin: 0; user-select: none; overflow-x: hidden; }
        
        /* 1. OVERLAYS */
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; cursor: pointer; }
        #key-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; flex-direction: column; justify-content: center; align-items: center; z-index: 5000; }
        
        /* 2. UI ELEMENTS */
        .key-box { border: 1px solid #3b82f6; padding: 30px; border-radius: 15px; background: #0d1117; box-shadow: 0 0 40px rgba(59, 130, 246, 0.2); width: 85%; max-width: 320px; }
        .key-input { width: 100%; padding: 12px; font-size: 18px; text-align: center; background: #010409; border: 1px solid #30363d; color: #3b82f6; margin-bottom: 15px; border-radius: 8px; outline: none; letter-spacing: 2px; text-transform: uppercase; }
        .btn-unlock { background: linear-gradient(to right, #2563eb, #1d4ed8); color: white; padding: 12px; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; font-size: 16px; width: 100%; }
        
        .loader { display:none; border: 3px solid #333; border-top: 3px solid #3b82f6; border-radius: 50%; width: 25px; height: 25px; animation: spin 0.8s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 3. MAIN APP */
        #app { display: none; padding: 10px; padding-bottom: 80px; }
        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; }
        
        /* BALLS */
        .ball-btn { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.1s; }
        .ball-btn:active { transform: scale(0.9); }
        .bg-g-violet-red { background: linear-gradient(135deg, #dc3545 50%, #6f42c1 50%); } 
        .bg-g-violet-green { background: linear-gradient(135deg, #28a745 50%, #6f42c1 50%); } 
        .bg-g-green { background: #28a745; } .bg-g-red { background: #dc3545; }

        /* HISTORY */
        #history-row { overflow-x: auto; white-space: nowrap; display: flex; gap: 8px; padding-bottom: 5px; }
        #history-row::-webkit-scrollbar { height: 4px; }
        #history-row::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
    </style>
</head>
<body class="min-h-screen bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">

    <!-- 1. START -->
    <div id="start-overlay" onclick="uiStart()">
        <h1 class="text-6xl">üß†</h1>
        <h2 class="text-white mt-4 font-bold tracking-widest">TAP TO START</h2>
    </div>

    <!-- 2. LOGIN -->
    <div id="key-screen">
        <div class="key-box">
            <h2 class="text-blue-500 font-bold text-xl mb-4">ACCESS CONTROL</h2>
            <input type="text" id="secretKey" class="key-input" placeholder="ENTER KEY">
            <button class="btn-unlock" onclick="attemptLogin()">CONNECT</button>
            <div class="loader" id="loadingSpinner"></div>
            <div id="error-msg" class="text-red-500 text-xs mt-3 hidden">Invalid Key</div>
        </div>
    </div>

    <!-- 3. MAIN APP -->
    <div id="app" class="max-w-md mx-auto">
        
        <!-- Header -->
        <div class="flex justify-between px-4 mb-6">
            <span class="text-xs text-gray-500" id="userDisplay">ID: --</span>
            <span class="text-xs text-green-500 font-bold">‚óè ONLINE</span>
        </div>

        <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 tracking-tighter mb-6">GOKU<span class="text-white">AI</span></h1>

        <!-- Scanner -->
        <input type="file" id="imgInput" accept="image/*" onchange="window.processImage(this)" class="hidden">
        <button onclick="document.getElementById('imgInput').click()" class="w-full bg-gray-900 border border-gray-700 text-blue-400 py-3 rounded-xl mb-4 font-bold hover:bg-gray-800 transition">
            üì∏ SCAN HISTORY
        </button>
        <div id="ocr-status" class="text-xs text-blue-500 hidden mb-2">Scanning...</div>

        <!-- History -->
        <div class="glass p-4 mb-6">
            <div class="flex justify-between text-xs text-gray-500 mb-2">
                <span>HISTORY (L-15)</span>
                <span onclick="resetUI()" class="text-red-500 cursor-pointer">RESET</span>
            </div>
            <div id="history-row">
                <span class="text-gray-600 text-sm italic w-full text-center py-2">Add data...</span>
            </div>
        </div>

        <!-- Keypad -->
        <div class="grid grid-cols-5 gap-3 mb-6 px-2">
            <div onclick="addLocal(0)" class="ball-btn bg-g-violet-red">0</div>
            <div onclick="addLocal(1)" class="ball-btn bg-g-green">1</div>
            <div onclick="addLocal(2)" class="ball-btn bg-g-red">2</div>
            <div onclick="addLocal(3)" class="ball-btn bg-g-green">3</div>
            <div onclick="addLocal(4)" class="ball-btn bg-g-red">4</div>
            <div onclick="addLocal(5)" class="ball-btn bg-g-violet-green">5</div>
            <div onclick="addLocal(6)" class="ball-btn bg-g-red">6</div>
            <div onclick="addLocal(7)" class="ball-btn bg-g-green">7</div>
            <div onclick="addLocal(8)" class="ball-btn bg-g-red">8</div>
            <div onclick="addLocal(9)" class="ball-btn bg-g-green">9</div>
        </div>

        <!-- Predict Button -->
        <button id="genBtn" onclick="window.runAnalysis()" class="w-full py-4 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold text-lg tracking-widest shadow-lg active:scale-95 transition">
            ‚ö° PREDICT NEXT
        </button>

        <!-- Result Area -->
        <div id="result-area" class="hidden mt-6 bg-gray-900 rounded-xl p-6 border border-blue-500/30">
            <p class="text-gray-500 text-xs tracking-widest mb-2">AI FORECAST</p>
            <div id="final-result" class="text-5xl font-black text-white mb-2">--</div>
            <div id="conf" class="text-blue-400 font-bold text-sm">--</div>
        </div>

    </div>

    <!-- UI FUNCTIONS (Local UI Logic Only) -->
    <script>
        // Global UI Arrays
        window.uiHistory = []; 

        function uiStart() {
            document.getElementById('start-overlay').style.display = 'none';
            document.getElementById('key-screen').style.display = 'flex';
        }

        // Passes control to Logic.js
        function attemptLogin() {
            const key = document.getElementById('secretKey').value;
            // Calls the secure function in logic.js
            if(window.secureLogin) {
                window.secureLogin(key); 
            } else {
                alert("Database Connecting... Wait 2s");
            }
        }

        // Called by User clicking buttons
        function addLocal(num) {
            if(window.uiHistory.length >= 15) window.uiHistory.shift();
            let type = num >= 5 ? 'BIG' : 'SMALL';
            window.uiHistory.push({ num: num, type: type });
            renderLocalHistory();
            
            // Pass data to logic.js global var for AI to use
            if(window.updateLogicData) window.updateLogicData(window.uiHistory);
        }

        function renderLocalHistory() {
            const container = document.getElementById('history-row');
            container.innerHTML = '';
            // Newest right
            window.uiHistory.forEach(h => {
                let colorClass = '';
                if(h.num===0) colorClass='bg-g-violet-red';
                else if(h.num===5) colorClass='bg-g-violet-green';
                else if([1,3,7,9].includes(h.num)) colorClass='bg-g-green';
                else colorClass='bg-g-red';

                const ball = document.createElement('div');
                ball.className = `min-w-[35px] h-[35px] rounded-full flex items-center justify-center font-bold text-white border border-white/20 ${colorClass}`;
                ball.innerText = h.num;
                container.appendChild(ball);
            });
            container.scrollLeft = container.scrollWidth;
        }

        function resetUI() {
            window.uiHistory = [];
            renderLocalHistory();
            if(window.updateLogicData) window.updateLogicData([]);
            document.getElementById('result-area').classList.add('hidden');
        }

        // Called by Logic.js to unlock
        window.unlockUI = function(user) {
            document.getElementById('key-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('userDisplay').innerText = "ID: " + user;
        }

        // Called by Logic.js to show result
        window.showResultUI = function(prediction, confidence) {
            const resArea = document.getElementById('result-area');
            const resText = document.getElementById('final-result');
            const confText = document.getElementById('conf');
            
            resArea.classList.remove('hidden');
            if(prediction === 'BIG') resText.innerHTML = "<span class='text-green-500'>BIG</span>";
            else resText.innerHTML = "<span class='text-red-500'>SMALL</span>";
            
            confText.innerText = `${confidence}% Confidence`;
        }
    </script>
</body>
</html>


